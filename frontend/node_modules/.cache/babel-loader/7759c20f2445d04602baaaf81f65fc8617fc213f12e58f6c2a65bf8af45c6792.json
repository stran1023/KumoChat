{"ast":null,"code":"import forge from \"node-forge\";\nimport CryptoJS from \"crypto-js\";\n\n// Sinh AES key ngẫu nhiên\nfunction generateAESKey() {\n  return CryptoJS.lib.WordArray.random(32).toString(); // 256-bit\n}\n\n// Mã hóa nội dung bằng AES key\nfunction encryptAES(content, aesKey) {\n  return CryptoJS.AES.encrypt(content, aesKey).toString();\n}\n\n// Mã hóa AES key bằng publicKey người nhận (RSA)\nexport function encryptAESKeyWithPublicKey(aesKey, publicKeyPem) {\n  const publicKey = forge.pki.publicKeyFromPem(publicKeyPem);\n  const encrypted = publicKey.encrypt(aesKey, \"RSA-OAEP\");\n  return forge.util.encode64(encrypted);\n}\nexport function encryptMessage(content, recipientPublicKeyPem, returnRawKey = false) {\n  const aesKeyRaw = CryptoJS.lib.WordArray.random(32).toString(); // 256-bit\n  const encryptedContent = CryptoJS.AES.encrypt(content, aesKeyRaw).toString();\n  const publicKey = forge.pki.publicKeyFromPem(recipientPublicKeyPem);\n  const encryptedAESKey = forge.util.encode64(publicKey.encrypt(aesKeyRaw, \"RSA-OAEP\"));\n  if (returnRawKey) {\n    return {\n      encryptedContent,\n      encryptedAESKey,\n      aesKeyRaw\n    };\n  }\n  return {\n    encryptedContent,\n    encryptedAESKey\n  };\n}","map":{"version":3,"names":["forge","CryptoJS","generateAESKey","lib","WordArray","random","toString","encryptAES","content","aesKey","AES","encrypt","encryptAESKeyWithPublicKey","publicKeyPem","publicKey","pki","publicKeyFromPem","encrypted","util","encode64","encryptMessage","recipientPublicKeyPem","returnRawKey","aesKeyRaw","encryptedContent","encryptedAESKey"],"sources":["D:/Chuyen nganh/Đồ án ATTT/KumoChat/frontend/src/utils/encryption.js"],"sourcesContent":["import forge from \"node-forge\";\r\nimport CryptoJS from \"crypto-js\";\r\n\r\n// Sinh AES key ngẫu nhiên\r\nfunction generateAESKey() {\r\n  return CryptoJS.lib.WordArray.random(32).toString(); // 256-bit\r\n}\r\n\r\n// Mã hóa nội dung bằng AES key\r\nfunction encryptAES(content, aesKey) {\r\n  return CryptoJS.AES.encrypt(content, aesKey).toString();\r\n}\r\n\r\n// Mã hóa AES key bằng publicKey người nhận (RSA)\r\nexport function encryptAESKeyWithPublicKey(aesKey, publicKeyPem) {\r\n  const publicKey = forge.pki.publicKeyFromPem(publicKeyPem);\r\n  const encrypted = publicKey.encrypt(aesKey, \"RSA-OAEP\");\r\n  return forge.util.encode64(encrypted);\r\n}\r\n\r\nexport function encryptMessage(content, recipientPublicKeyPem, returnRawKey = false) {\r\n  const aesKeyRaw = CryptoJS.lib.WordArray.random(32).toString(); // 256-bit\r\n  const encryptedContent = CryptoJS.AES.encrypt(content, aesKeyRaw).toString();\r\n  const publicKey = forge.pki.publicKeyFromPem(recipientPublicKeyPem);\r\n  const encryptedAESKey = forge.util.encode64(publicKey.encrypt(aesKeyRaw, \"RSA-OAEP\"));\r\n\r\n  if (returnRawKey) {\r\n    return { encryptedContent, encryptedAESKey, aesKeyRaw };\r\n  }\r\n\r\n  return { encryptedContent, encryptedAESKey };\r\n}\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,YAAY;AAC9B,OAAOC,QAAQ,MAAM,WAAW;;AAEhC;AACA,SAASC,cAAcA,CAAA,EAAG;EACxB,OAAOD,QAAQ,CAACE,GAAG,CAACC,SAAS,CAACC,MAAM,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC;AACvD;;AAEA;AACA,SAASC,UAAUA,CAACC,OAAO,EAAEC,MAAM,EAAE;EACnC,OAAOR,QAAQ,CAACS,GAAG,CAACC,OAAO,CAACH,OAAO,EAAEC,MAAM,CAAC,CAACH,QAAQ,CAAC,CAAC;AACzD;;AAEA;AACA,OAAO,SAASM,0BAA0BA,CAACH,MAAM,EAAEI,YAAY,EAAE;EAC/D,MAAMC,SAAS,GAAGd,KAAK,CAACe,GAAG,CAACC,gBAAgB,CAACH,YAAY,CAAC;EAC1D,MAAMI,SAAS,GAAGH,SAAS,CAACH,OAAO,CAACF,MAAM,EAAE,UAAU,CAAC;EACvD,OAAOT,KAAK,CAACkB,IAAI,CAACC,QAAQ,CAACF,SAAS,CAAC;AACvC;AAEA,OAAO,SAASG,cAAcA,CAACZ,OAAO,EAAEa,qBAAqB,EAAEC,YAAY,GAAG,KAAK,EAAE;EACnF,MAAMC,SAAS,GAAGtB,QAAQ,CAACE,GAAG,CAACC,SAAS,CAACC,MAAM,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC;EAChE,MAAMkB,gBAAgB,GAAGvB,QAAQ,CAACS,GAAG,CAACC,OAAO,CAACH,OAAO,EAAEe,SAAS,CAAC,CAACjB,QAAQ,CAAC,CAAC;EAC5E,MAAMQ,SAAS,GAAGd,KAAK,CAACe,GAAG,CAACC,gBAAgB,CAACK,qBAAqB,CAAC;EACnE,MAAMI,eAAe,GAAGzB,KAAK,CAACkB,IAAI,CAACC,QAAQ,CAACL,SAAS,CAACH,OAAO,CAACY,SAAS,EAAE,UAAU,CAAC,CAAC;EAErF,IAAID,YAAY,EAAE;IAChB,OAAO;MAAEE,gBAAgB;MAAEC,eAAe;MAAEF;IAAU,CAAC;EACzD;EAEA,OAAO;IAAEC,gBAAgB;IAAEC;EAAgB,CAAC;AAC9C","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}